<div class="wrap">
<div class="nav">
	<div class="return"><a href="__URL__/index/pid/{$Think.get.pid}">返回上一级</a></div>
</div>

<form id="J_rigths_form" class="J_ajaxForm" action="__URL__/update" method="post" enctype="multipart/form-data">
<div class="J_tabs_contents">
	<div>
		<div class="h_a">工作日期</div>
		<div class="table_full">
			<table width="100%">
				<col class="th" />
				<col width="400" />
				<col />
				<tr>
					<th>标题</th>
					<td><input type="text" class="input length_5" name="title" value="{$data.title}"></td>
				</tr>
				<tr>
					<th>地址</th>
					<td><input type="text" class="input length_5" name="url" value="{$data.url}"></td>
				</tr>
				<!-- <tr>
					<th>时长</th>
					<td><input type="text" class="input length_5" name="times" value="{$data.times}"></td>
				</tr> -->
				<tr>
					<th>封面</th>
					<td>
						<input type="file" data-type="qiniu" data-base-url="http://7xopel.com2.z0.glb.qiniucdn.com" name="cover">
						<div>
							<img src="http://7xopel.com2.z0.glb.qiniucdn.com/{$data.cover_url}?imageView/1/w/246/h/185/q/85" alt="">
						</div>
					</td>
				</tr>
				<tr>
					<th>嘉宾</th>
					<td>
						<div class="fl">
							<div id="J_search_suggestion" class="forum_search_pop" style="display:none;margin-top:25px;"></div>
						</div>
						<input id="J_search_input" class="input length_3 mr10" name="guests" autoComplete="off" type="text" value="{$data.guests}">
						<input type="hidden" name="guests_id" value="{$data.guests_id}">
					</td>
				</tr>
				<tr>
					<th>公司</th>
					<td>
						<div class="fl">
							<div id="J_search_suggestion_company" class="forum_search_pop" style="display:none;margin-top:25px;width: 290px"></div>
						</div>
						<input id="J_search_input_company" class="input length_3 mr10" name="company" autoComplete="off" type="text" value="{$data.company}" style="width: 290px">
						<input type="hidden" name="company_id" value="{$data.company_id}">
					</td>
				</tr>
				<tr>
					<th>分类</th>
					<td>
						<volist name="category" id="vo">
							<label><input name="category[]" <if condition="in_array($vo['id'], explode(',',$data['category']))" >checked</if> data-xid="J_check_6" class="J_check" type="checkbox" value="{$vo.id}"><span>{$vo.title}</span></label>
						</volist>
					</td>
				</tr>

				<tr id="course_info" style="display: none">
					<th>公开课信息</th>
					<td><label>城市</label><input type="text" class="input length_5" name="course_city" value="{$data.course_city}"></td>
					<td><label>上课日期</label><input type="text" class="input length_5 J_date" name="course_date" value="{:date('Y-m-d', $data['course_date'])}"></td>
					<td><label>花絮/子视频</label>
						<select name="course_type" id="course_type">
							<option value="">请选择</option>
							<option value="1" <eq name="data.course_type" value="1">selected</eq>>公开课花絮</option>
							<option value="2" <eq name="data.course_type" value="2">selected</eq>>公开课子视频</option>
						</select>
					</td>
					<td id="course_sub_parent" style="display: none">
						<label>子视频分类</label>
						<select name="course_parent_id" >
							<option value="">请选择</option>
							<volist name="course" id="vo">
								<option value="{$vo.id}" <eq name="data.course_parent_id" value="$vo.id">selected</eq>>{$vo.course_city}|{$vo.course_date}|{$vo.title}</option>
							</volist>
						</select>
					</td>
				</tr>

				<tr id="gold_award_info" style="display: none">
					<th>金熊奖信息</th>
					<td><label>年份</label><input type="text" class="input length_5 J_date" name="match_date" value="{:date('Y-m-d', $data['matchdate'])}"></td>
					<td><label>花絮/子视频</label>
						<select name="match_type" id="gold_award_type">
							<option value="">请选择</option>
							<option value="1" <eq name="data.match_type" value="1">selected</eq>>金熊奖花絮</option>
							<option value="2" <eq name="data.match_type" value="2">selected</eq>>金熊奖分赛视频</option>
						</select>
					</td>
					<td id="gold_award_sub_match" style="display: none">
						<label>花絮</label>
						<select name="match_parent_id" >
							<option value="">请选择</option>
							<volist name="gold_match" id="vo">
								<option value="{$vo.id}" <eq name="data.match_parent_id" value="$vo.id">selected</eq>>{:date('Y',$vo.date)}|{$vo.title}</option>
							</volist>
						</select>
					</td>
					<td id="match_level" style="width: 20%;display: none">
						<label>分赛阶段</label>
						<select name="match_level" >
							<option value="">请选择</option>
							<option value="1" <eq name="data.match_level" value="1">selected</eq>>初赛</option>
							<option value="2" <eq name="data.match_level" value="2">selected</eq>>决赛</option>
						</select>
					</td>
					<td>
						<label>金熊奖栏目</label>
						<select name="gold_award_id" >
							<option value="">请选择</option>
							<volist name="gold_awards" id="vo">
								<option value="{$vo.id}" <eq name="data.gold_award_id" value="$vo.id">selected</eq>>{:date('Y',$vo.date)}|{$vo.title}</option>
							</volist>
						</select>
					</td>
				</tr>

				<tr>
					<th>排序</th>
					<td><input type="number" class="input length_5" name="sort" value="{$data.sort}"><p>数值越大越靠前</p></td>
				</tr>
				<tr>
					<th>是否需要登录<br><b style="color: red">若选“是”，登录后才能观看！</b></th>
					<td>
						<select name="auth">
							<option value="0" <eq name="data.auth" value="0">selected</eq>>否</option>
							<option value="1" <eq name="data.auth" value="1">selected</eq>>是</option>
						</select>
					</td>
				</tr>
				<tr>
					<th>是否设为热门<br><b style="color: red">若选“是”，该视频将出现在热门视频列表！</b></th>
					<td>
						<select name="is_hot">
							<option value="0" <eq name="data.is_hot" value="0">selected</eq>>否</option>
							<option value="1" <eq name="data.is_hot" value="1">selected</eq>>是</option>
						</select>
					</td>
				</tr>
				<tr>
					<th>封面（大图）</th>
					<td>
						<input type="file" data-type="qiniu" data-base-url="http://7xopel.com2.z0.glb.qiniucdn.com" name="big_cover">
						<div>
							<img src="http://7xopel.com2.z0.glb.qiniucdn.com/{$data.big_cover_url}?imageView/1/w/246/h/185/q/85" alt="">
						</div>
					</td>
				</tr>
				<tr>
					<th>是否设为推荐<br><b style="color: red">若选“是”，视频将出现在列表首页！</b></th>
					<td>
						<select name="is_recommend">
							<option value="0" <eq name="data.is_recommend" value="0">selected</eq>>否</option>
							<option value="1" <eq name="data.is_recommend" value="1">selected</eq>>是</option>
						</select>
					</td>
				</tr>
				<tr>
					<th>是否为会员专享<br><b style="color: red">若选“是”，只有会员才能观看！</b></th>
					<td>
						<select name="is_vip">
							<option value="0" <eq name="data.is_vip" value="0">selected</eq>>否</option>
							<option value="1" <eq name="data.is_vip" value="1">selected</eq>>是</option>
						</select>
					</td>
				</tr>
				<tr>
					<th>收费标准</th>
					<td>
						<volist name="charge_standard" id="vo">
							<label><input name="charge_standard[]" <if condition="in_array($vo['id'], explode(',',$data['charge_standard']))" >checked</if> data-xid="J_check_6" class="J_check" type="checkbox" value="{$vo.id}"><span>{$vo.price}元({$vo.note})</span></label>
						</volist>
					</td>
				</tr>
				<tr>
					<th>保存<br><b style="color: red">若选“是”，视频只被保存在数据库，不会被马上发布到app！</b></th>
					<td>
						<select name="conserve">
							<option value="0" <eq name="data.status" value="1">selected</eq>>否</option>
							<option value="1" <eq name="data.status" value="0">selected</eq>>是</option>
						</select>
					</td>
				</tr>
			</table>
		</div>
	</div>

<div class="btn_wrap">
	<div class="btn_wrap_pd">
		<input type="hidden" name="id" value="{$data.id}">
		<input type="hidden" name="qiniu_token" value="{$token}">
		<button type="submit" class="btn btn_submit mr20 J_ajax_submit_btn" id="J_rights_form_btn">提交</button>
	</div>
</div>
</form>
</div>
<!--唤起公开课信息编辑框-->
<script>
	$(document).ready(function(){
        //根据条件判断默认唤起的窗口
		var category = $('input[checked]').val();
		if (category==4){
			$('#course_info').show();
			var type = $('#course_type').val();
			if (type==2){
				$('#course_sub_parent').show();
			}
		}else if(category==3){
			$('#gold_award_info').show();
			var type = $('#gold_award_type').val();
			if (type==2){
				$('#gold_award_sub_match').show();
				$('#match_level').show();

			}
		}

		$('input[type=checkbox]').change(function(){
			var check = $(this).prop('checked');
			if (check){
				var cate = $(this).val();
				//被选中并且是婚礼公开课或策划比赛（金熊奖比赛）时唤起
				if (cate==4){
					$('input[value=3][type=checkbox]').attr('checked',false);
					$('#gold_award_info').hide();
					$('#course_info').show();
				}else if(cate==3){
					$('input[value=4][type=checkbox]').attr('checked',false);
					$('#course_info').hide();
					$('#gold_award_info').show();
				}
			}else {
				var value = $(this).val();
				if(value==4){
					$('#course_info').hide();
				}else if(value==3){
					$('#gold_award_info').hide();
				}
			}
		});
		//公开课子视频窗口
		$('#course_type').change(function(){
			var course_type = $(this).val();
			if (course_type==2){
				$('#course_sub_parent').show();
			}else {
				$('#course_sub_parent').hide();
			}

		});
		//金熊奖子视频窗口
		$('#gold_award_type').change(function(){
			var gold_award_type = $(this).val();
			if (gold_award_type==2){
				$('#gold_award_sub_match').show();
				$('#match_level').show();
			}else {
				$('#gold_award_sub_match').hide();
				$('#match_level').hide();
			}

		});

	});
</script>
<!--唤起公开课信息编辑框/-->
<script>
	$(function(){
		$('.cate').change(function() {
			var name = $(this).attr('name');
			$('input[name='+ name +'_title]').val($(this).children('option:selected').text());
		});
	})
</script>
<!--嘉宾搜搜-->
<script>
	$(function(){
		$('.cate').change(function() {
			var name = $(this).attr('name');
			$('input[name='+ name +'_title]').val($(this).children('option:selected').text());
		});

		$('#J_search_suggestion').on('click', 'li', function(){
			$('input[name=guests_id]').val($(this).data('id'));
			$('input[name=guests]').val($(this).text());
		})

		/*
		 搜索建议：输入>=2个字符开始提交查询，支持上下键选择；点击下拉的匹配项进入分类编辑，点击搜索按钮则高亮匹配的tr行
		 */

		var search_input = $('#J_search_input'),			//搜索栏
				suggestion_list = $('#J_search_suggestion'),	//搜索匹配列表
				input_val;										//搜索值，用于比较是否有更改

		//搜索框聚焦
		search_input.focus(function(){
			var $this = $(this);

			//搜索框粘帖
			this.onpaste = function(){

				//清楚重复的延时操作
				if(search_input.ptimer) {
					clearTimeout(search_input.ptimer);
				}

				//粘帖半秒后提交查询
				search_input.ptimer = setTimeout(function(){
					search_suggestion($('#J_search_input').val());
				}, 500)

			}

			//通过浏览器（ff8.0）“后退”到本页面时，可能搜索内容为空，但是有隐藏的匹配项
			if(!$this.val()) {
				return false;
			}

			//已经匹配搜索，搜索框重新聚焦时显示匹配，避免重复ajax
			if(suggestion_list.children().length) {
				suggestion_list.fadeIn('fast');
			}

		});



		//搜索输入
		search_input.keyup(function(e){
			var $this = $(this);

			//键盘上下选择搜索建议
			if(suggestion_list.children().length & (e.keyCode === 38 || e.keyCode === 40)) {

				var li_current = suggestion_list.find('li.current'); //当前选中项，上下键未修改状态
				/*var f_or_l = (e.keyCode === 40 ? 'first' : 'last'),
				 p_or_n = (e.keyCode === 40 ? $.next : 'prev');*/
				//
				if(e.keyCode === 38) {
					//键盘_向上

					if(!li_current.length) {
						//没有有选中项时
						suggestion_list.find('li:last').addClass('current');
					}else{
						//有选中项时
						li_current.removeClass('current').prev().addClass('current');
					}



				}else if(e.keyCode === 40) {
					//键盘_向下

					if(!li_current.length) {
						//没有有选中项时
						suggestion_list.find('li:first').addClass('current');
					}else{
						//有选中项时
						li_current.removeClass('current').next().addClass('current');
					}

				}

				if(suggestion_list.find('li.current').length) {
					search_input.val(suggestion_list.find('li.current').text());
				}else{
					search_input.val(input_val);
				}

				return false;


			}


			if($this.val() === input_val) {
				return false; //搜索值未改变则不做查询
			}

			//停止输入半秒后开始查询
			if(search_input.timer) {
				clearTimeout(search_input.timer);
			}
			search_input.timer = setTimeout(function(){
				search_suggestion($this.val());
			}, 500);

		});

		//搜索框失焦，隐藏匹配列表
		search_input.blur(function() {
			suggestion_list.fadeOut('fast');
		});

		//搜索查询显示函数
		function search_suggestion(search_data) {
			input_val = search_data; //把搜索值赋给input_val，用于比较搜索值
			var search_text = $.trim(search_data.replace(/[^\x00-\xff]/g, "**")); //搜索内容首尾去空格，且每1个汉字转由两个*符号替代

			if(search_text.length >= 2) {
				//搜索内容大于2个字符，提交查询

				$.post('__URL__/search', {'guests':search_data}, function(data) {

					if(data.state === 'success') {
						var push_html = [];
						$.each(data.data, function(i, o){
							push_html.push('<li class="item" data-id='+ o.id +'>'+ o.title +'</li>');
						});console.log(push_html);
						suggestion_list.html($('<ul/>').append(push_html.join(''))).fadeIn('fast');
					}else{
						suggestion_list.fadeOut('fast', function(){
							$(this).empty();
						});
					}

				}, 'json');

			}else{
				//搜索内容大于2个字符，隐藏并清空下拉匹配
				suggestion_list.fadeOut('fast', function(){
					$(this).empty();
				});
			}
		}

	});

</script>
<!--公司搜索-->
<script>
	$(function(){
		$('.cate').change(function() {
			var name = $(this).attr('name');
			$('input[name='+ name +'_title]').val($(this).children('option:selected').text());
		});

		$('#J_search_suggestion_company').on('click', 'li', function(){
			$('input[name=company_id]').val($(this).data('id'));
			$('input[name=company]').val($(this).text());
		})

		/*
		 搜索建议：输入>=2个字符开始提交查询，支持上下键选择；点击下拉的匹配项进入分类编辑，点击搜索按钮则高亮匹配的tr行
		 */

		var search_input = $('#J_search_input_company'),			//搜索栏
				suggestion_list = $('#J_search_suggestion_company'),	//搜索匹配列表
				input_val;										//搜索值，用于比较是否有更改

		//搜索框聚焦
		search_input.focus(function(){
			var $this = $(this);

			//搜索框粘帖
			this.onpaste = function(){

				//清楚重复的延时操作
				if(search_input.ptimer) {
					clearTimeout(search_input.ptimer);
				}

				//粘帖半秒后提交查询
				search_input.ptimer = setTimeout(function(){
					search_suggestion($('#J_search_input_company').val());
				}, 500)

			}

			//通过浏览器（ff8.0）“后退”到本页面时，可能搜索内容为空，但是有隐藏的匹配项
			if(!$this.val()) {
				return false;
			}

			//已经匹配搜索，搜索框重新聚焦时显示匹配，避免重复ajax
			if(suggestion_list.children().length) {
				suggestion_list.fadeIn('fast');
			}

		});



		//搜索输入
		search_input.keyup(function(e){
			var $this = $(this);

			//键盘上下选择搜索建议
			if(suggestion_list.children().length & (e.keyCode === 38 || e.keyCode === 40)) {

				var li_current = suggestion_list.find('li.current'); //当前选中项，上下键未修改状态
				/*var f_or_l = (e.keyCode === 40 ? 'first' : 'last'),
				 p_or_n = (e.keyCode === 40 ? $.next : 'prev');*/
				//
				if(e.keyCode === 38) {
					//键盘_向上

					if(!li_current.length) {
						//没有有选中项时
						suggestion_list.find('li:last').addClass('current');
					}else{
						//有选中项时
						li_current.removeClass('current').prev().addClass('current');
					}



				}else if(e.keyCode === 40) {
					//键盘_向下

					if(!li_current.length) {
						//没有有选中项时
						suggestion_list.find('li:first').addClass('current');
					}else{
						//有选中项时
						li_current.removeClass('current').next().addClass('current');
					}

				}

				if(suggestion_list.find('li.current').length) {
					search_input.val(suggestion_list.find('li.current').text());
				}else{
					search_input.val(input_val);
				}

				return false;


			}


			if($this.val() === input_val) {
				return false; //搜索值未改变则不做查询
			}

			//停止输入半秒后开始查询
			if(search_input.timer) {
				clearTimeout(search_input.timer);
			}
			search_input.timer = setTimeout(function(){
				search_suggestion($this.val());
			}, 500);

		});

		//搜索框失焦，隐藏匹配列表
		search_input.blur(function() {
			suggestion_list.fadeOut('fast');
		});

		//搜索查询显示函数
		function search_suggestion(search_data) {
			input_val = search_data; //把搜索值赋给input_val，用于比较搜索值
			var search_text = $.trim(search_data.replace(/[^\x00-\xff]/g, "**")); //搜索内容首尾去空格，且每1个汉字转由两个*符号替代

			if(search_text.length >= 2) {
				//搜索内容大于2个字符，提交查询

				$.post('/SchoolGuests/getCompanyList', {'company':search_data}, function(data) {

					if(data.state === 'success') {
						var push_html = [];
						$.each(data.data, function(i, o){
							push_html.push('<li class="item" data-id='+ o.id +'>'+ o.region_name +' | '+ o.name +'</li>');
						});console.log(push_html);
						suggestion_list.html($('<ul/>').append(push_html.join(''))).fadeIn('fast');
					}else{
						suggestion_list.fadeOut('fast', function(){
							$(this).empty();
						});
					}

				}, 'json');

			}else{
				//搜索内容大于2个字符，隐藏并清空下拉匹配
				suggestion_list.fadeOut('fast', function(){
					$(this).empty();
				});
			}
		}

	});

</script>
