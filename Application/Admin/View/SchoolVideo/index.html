<div class="wrap J_check_wrap">
	<!--说明-->
	<div class="h_a">说明</div>
	<div class="prompt_text">
		<ol>
			<li>视频管理</li>
		</ol>
	</div>
	<!--/说明-->
	<!--搜索-->
	<div class="h_a">搜索</div>
	<form action="__URL__/index" method="get">
		<div class="search_type cc mb10">
			<label>标题：</label>
			<input name="title" type="text" class="input length_2 mr10" value="{$Think.get.title}"/>
			<!--<label>嘉宾：</label>-->
			<!--<select name="guests_id">-->
				<!--<option value="">请选择</option>-->
				<!--<volist name="gudests" id="vo">-->
					<!--<option value="{$vo.id}" <eq name="Think.request.guests_id" value="$vo['id']">selected</eq>>{$vo.title}</option>-->
				<!--</volist>-->
			<!--</select>-->

			<tr>
				<th>嘉宾</th>
				<td>
					<div class="fl">
						<div id="J_search_suggestion" class="forum_search_pop" style="display:none;margin-top:25px;"></div>
					</div>
					<input id="J_search_input" class="input length_3 mr10" name="guests" autoComplete="off" type="text" value="{$Think.get.guests}">
					<input type="hidden" name="guests_id" value="{$Think.get.guests_id}">
				</td>
			</tr>

			<label>会员专享：</label>
			<select name="is_vip">
				<option value="">请选择</option>
				<option value="0" <eq name="Think.request.is_vip" value="0">selected</eq>>否</option>
				<option value="1" <eq name="Think.request.is_vip" value="1">selected</eq>>是</option>
			</select>
			<label>推荐：</label>
			<select name="is_recommend">
				<option value="">请选择</option>
				<option value="0" <eq name="Think.request.is_recommend" value="0">selected</eq>>否</option>
				<option value="1" <eq name="Think.request.is_recommend" value="1">selected</eq>>是</option>
			</select>
			<label>热门：</label>
			<select name="is_hot">
				<option value="">请选择</option>
				<option value="0" <eq name="Think.request.is_hot" value="0">selected</eq>>否</option>
				<option value="1" <eq name="Think.request.is_hot" value="1">selected</eq>>是</option>
			</select>
			<label>分类：</label>
			<select class="cate" name="category">
				<option value="">请选择</option>
				<volist name="category" id="vo">
					<option value="{$vo.id}" <eq name="Think.request.category" value="$vo['id']">selected</eq>>{$vo.title}</option>
				</volist>
			</select>
			<button type="submit" class="btn">搜索</button>
		</div>
	</form>
	<!--/搜索-->
	<!--操作-->
	<div class="mb10">
		<a class="btn" href="__URL__/add" title="新增"><span class="add"></span>新增</a>
	</div>
	<!--/操作-->
	<!--列表-->
	<form class="J_ajaxForm" action="" method="post">
		<div class="table_list">
			<lists:list box="id" name="list" show="{field:id,title:编号,width:60}{field:title,title:标题,width:200}{field:url,title:播放地址,width:200}{field:guests,title:嘉宾,width:80}{field:company,title:公司,width:100}{field:is_big_cover,title:大图上传,width:80}{field:cate_title,title:分类,width:120}{field:hot,title:是否热门,url:__URL__/change_status/id/$id/is_status/$is_hot/remark/is_hot,width:60}{field:vip,title:是否会员专享,url:__URL__/change_status/id/$id/is_status/$is_vip/remark/is_vip,width:60}{field:recommend,title:是否推荐,url:__URL__/change_status/id/$id/is_status/$is_recommend/remark/is_recommend,width:60}{field:create_time,title:创建时间,func:date='y-m-d H#i'/###,width:120}{field:status,title:状态,width:60,func:get_status}{{title:操作,text:编辑,url:__URL__/edit/id/$id}}"/>
			<div class="p10"></div>
		</div>
		<div class="btn_wrap">
			<div class="btn_wrap_pd">
				<div class="select_pages"><div class="pages">{$page}</div></div>
				<button class="btn J_ajax_submit_btn" type="button" data-action="__URL__/delete" data-subcheck="true" data-msg="确定要删除选中的数据？">删除</button>
				<button class="btn J_ajax_submit_btn" type="button" data-action="__URL__/forbid/cid/{$Think.get.cid}">禁用</button>
				<button class="btn J_ajax_submit_btn" type="button" data-action="__URL__/resume/cid/{$Think.get.cid}">恢复</button>
			</div>
		</div>
	</form>
	<!--/列表-->
</div>
<!--嘉宾搜索-->
<script>
	$(function(){
		$('.cate').change(function() {
			var name = $(this).attr('name');
			$('input[name='+ name +'_title]').val($(this).children('option:selected').text());
		});

		$('#J_search_suggestion').on('click', 'li', function(){
			$('input[name=guests_id]').val($(this).data('id'));
			$('input[name=guests]').val($(this).text());
		})

		/*
		 搜索建议：输入>=2个字符开始提交查询，支持上下键选择；点击下拉的匹配项进入分类编辑，点击搜索按钮则高亮匹配的tr行
		 */

		var search_input = $('#J_search_input'),			//搜索栏
				suggestion_list = $('#J_search_suggestion'),	//搜索匹配列表
				input_val;										//搜索值，用于比较是否有更改

		//搜索框聚焦
		search_input.focus(function(){
			var $this = $(this);

			//搜索框粘帖
			this.onpaste = function(){

				//清楚重复的延时操作
				if(search_input.ptimer) {
					clearTimeout(search_input.ptimer);
				}

				//粘帖半秒后提交查询
				search_input.ptimer = setTimeout(function(){
					search_suggestion($('#J_search_input').val());
				}, 500)

			}

			//通过浏览器（ff8.0）“后退”到本页面时，可能搜索内容为空，但是有隐藏的匹配项
			if(!$this.val()) {
				return false;
			}

			//已经匹配搜索，搜索框重新聚焦时显示匹配，避免重复ajax
			if(suggestion_list.children().length) {
				suggestion_list.fadeIn('fast');
			}

		});



		//搜索输入
		search_input.keyup(function(e){
			var $this = $(this);

			//键盘上下选择搜索建议
			if(suggestion_list.children().length & (e.keyCode === 38 || e.keyCode === 40)) {

				var li_current = suggestion_list.find('li.current'); //当前选中项，上下键未修改状态
				/*var f_or_l = (e.keyCode === 40 ? 'first' : 'last'),
				 p_or_n = (e.keyCode === 40 ? $.next : 'prev');*/
				//
				if(e.keyCode === 38) {
					//键盘_向上

					if(!li_current.length) {
						//没有有选中项时
						suggestion_list.find('li:last').addClass('current');
					}else{
						//有选中项时
						li_current.removeClass('current').prev().addClass('current');
					}



				}else if(e.keyCode === 40) {
					//键盘_向下

					if(!li_current.length) {
						//没有有选中项时
						suggestion_list.find('li:first').addClass('current');
					}else{
						//有选中项时
						li_current.removeClass('current').next().addClass('current');
					}

				}

				if(suggestion_list.find('li.current').length) {
					search_input.val(suggestion_list.find('li.current').text());
				}else{
					search_input.val(input_val);
				}

				return false;


			}


			if($this.val() === input_val) {
				return false; //搜索值未改变则不做查询
			}

			//停止输入半秒后开始查询
			if(search_input.timer) {
				clearTimeout(search_input.timer);
			}
			search_input.timer = setTimeout(function(){
				search_suggestion($this.val());
			}, 500);

		});

		//搜索框失焦，隐藏匹配列表
		search_input.blur(function() {
			suggestion_list.fadeOut('fast');
		});

		//搜索查询显示函数
		function search_suggestion(search_data) {
			input_val = search_data; //把搜索值赋给input_val，用于比较搜索值
			var search_text = $.trim(search_data.replace(/[^\x00-\xff]/g, "**")); //搜索内容首尾去空格，且每1个汉字转由两个*符号替代

			if(search_text.length >= 2) {
				//搜索内容大于2个字符，提交查询

				$.post('__URL__/search', {'guests':search_data}, function(data) {

					if(data.state === 'success') {
						var push_html = [];
						$.each(data.data, function(i, o){
							push_html.push('<li class="item" data-id='+ o.id +'>'+ o.title +'</li>');
						});console.log(push_html);
						suggestion_list.html($('<ul/>').append(push_html.join(''))).fadeIn('fast');
					}else{
						suggestion_list.fadeOut('fast', function(){
							$(this).empty();
						});
					}

				}, 'json');

			}else{
				//搜索内容大于2个字符，隐藏并清空下拉匹配
				suggestion_list.fadeOut('fast', function(){
					$(this).empty();
				});
			}
		}

	});

</script>